# utils/recipes.py
# -*- coding: utf-8 -*-
from typing import Dict, List

# 발달장애인이 단독/보조하에 하기 쉬운 "초간단" 레시피 모음
# 설계 원칙
# - 칼 사용 최소화(가능하면 가위/손)
# - 불 세기: 약불/중불만 사용
# - 시간: "몇 분" 또는 "익을 때까지"로 단순화
# - 선택 재료/선택 양념 제거(헷갈림 방지)
# - 1문장 1행 1동작
# - 안전: 위험한 작업(기름 튐/날칼/과열) 최소화

BASE_RECIPES: Dict[str, Dict] = {
    # ───────────── 밥/계란(가장 쉬움) ─────────────
    "간장계란밥": {
        "도구": ["그릇", "숟가락"],
        "재료": ["밥", "계란", "간장"],
        "순서": [
            "① 그릇에 밥을 담아요.",
            "② 계란을 깨서 밥 위에 올려요.",
            "③ 간장을 숟가락으로 1번 뿌려요.",
            "④ 숟가락으로 잘 섞어요.",
        ],
    },
    "밥버터간장": {
        "도구": ["그릇", "숟가락"],
        "재료": ["밥", "버터", "간장"],
        "순서": [
            "① 그릇에 밥을 담아요.",
            "② 버터를 밥 위에 올려요.",
            "③ 간장을 숟가락으로 1번 뿌려요.",
            "④ 숟가락으로 잘 섞어요.",
        ],
    },
    "계란후라이": {
        "도구": ["프라이팬", "뒤집개", "접시"],
        "재료": ["계란", "식용유"],
        "순서": [
            "① 프라이팬에 식용유를 조금 넣어요.",
            "② 불을 약불로 켜요.",
            "③ 계란을 깨서 프라이팬에 넣어요.",
            "④ 흰자가 하얘지면 불을 꺼요.",
            "⑤ 뒤집개로 접시에 옮겨요.",
        ],
    },
    "스크램블에그": {
        "도구": ["그릇", "젓가락", "프라이팬"],
        "재료": ["계란", "식용유"],
        "순서": [
            "① 그릇에 계란을 깨요.",
            "② 젓가락으로 섞어요.",
            "③ 프라이팬에 식용유를 조금 넣어요.",
            "④ 불을 약불로 켜요.",
            "⑤ 계란을 부어요.",
            "⑥ 젓가락으로 천천히 저어요.",
            "⑦ 몽글몽글해지면 불을 꺼요.",
        ],
    },
    "계란찜(전자레인지)": {
        "도구": ["전자레인지용 그릇", "젓가락"],
        "재료": ["계란", "물"],
        "순서": [
            "① 그릇에 계란을 깨요.",
            "② 물을 계란만큼 넣어요.",
            "③ 젓가락으로 섞어요.",
            "④ 전자레인지에 2분 돌려요.",
            "⑤ 덜 익었으면 30초 더 돌려요.",
        ],
    },

    # ───────────── 면/국물(끓이기만) ─────────────
    "라면": {
        "도구": ["냄비", "젓가락", "그릇"],
        "재료": ["라면", "물"],
        "순서": [
            "① 냄비에 물을 넣어요.",
            "② 불을 중불로 켜요.",
            "③ 물이 끓으면 면을 넣어요.",
            "④ 스프를 넣어요.",
            "⑤ 3분 기다려요.",
            "⑥ 그릇에 옮겨요.",
        ],
    },
    "떡국": {
        "도구": ["냄비", "국자", "그릇"],
        "재료": ["떡국떡", "시판 떡국국물"],
        "순서": [
            "① 냄비에 물을 넣어요.",
            "② 떡국떡을 넣어요.",
            "③ 불을 중불로 켜요.",
            "④ 떡이 말랑해질 때까지 끓여요.",
            "⑤ 시판 떡국국물을 넣어요.",
            "⑥ 한 번 더 끓으면 불을 꺼요.",
            "⑦ 그릇에 옮겨요.",
        ],
    },
    "미역국": {
        "도구": ["냄비", "그릇", "숟가락"],
        "재료": ["건미역", "물", "국간장"],
        "순서": [
            "① 건미역을 물에 넣어요.",
            "② 5분 기다려요.",
            "③ 미역을 물로 한 번 헹궈요.",
            "④ 냄비에 물을 넣어요.",
            "⑤ 미역을 넣어요.",
            "⑥ 불을 중불로 켜요.",
            "⑦ 끓으면 국간장을 넣어요.",
            "⑧ 5분 더 끓이고 불을 꺼요.",
        ],
    },
    "된장찌개": {
        "도구": ["냄비", "숟가락", "그릇"],
        "재료": ["된장", "물"],
        "순서": [
            "① 냄비에 물을 넣어요.",
            "② 된장을 숟가락으로 넣어요.",
            "③ 숟가락으로 풀어요.",
            "④ 불을 중불로 켜요.",
            "⑤ 끓으면 5분 더 끓여요.",
            "⑥ 불을 꺼요.",
            "⑦ 그릇에 옮겨요.",
        ],
    },
    "김치찌개(간단)": {
        "도구": ["냄비", "가위", "그릇"],
        "재료": ["김치", "참치캔", "물"],
        "순서": [
            "① 김치를 가위로 잘게 잘라요.",
            "② 냄비에 김치를 넣어요.",
            "③ 참치캔을 넣어요.",
            "④ 물을 넣어요.",
            "⑤ 불을 중불로 켜요.",
            "⑥ 끓으면 7분 더 끓여요.",
            "⑦ 불을 꺼요.",
            "⑧ 그릇에 옮겨요.",
        ],
    },

    # ───────────── 덮밥/비빔(불 없이도 가능) ─────────────
    "참치마요덮밥": {
        "도구": ["그릇", "숟가락"],
        "재료": ["밥", "참치캔", "마요네즈"],
        "순서": [
            "① 그릇에 밥을 담아요.",
            "② 참치캔을 열어요.",
            "③ 밥 위에 참치를 올려요.",
            "④ 마요네즈를 위에 뿌려요.",
            "⑤ 숟가락으로 섞어 먹어요.",
        ],
    },
    "주먹밥": {
        "도구": ["그릇", "비닐장갑", "숟가락"],
        "재료": ["밥", "김가루"],
        "순서": [
            "① 비닐장갑을 껴요.",
            "② 그릇에 밥을 넣어요.",
            "③ 김가루를 넣어요.",
            "④ 손으로 섞어요.",
            "⑤ 동그랗게 뭉쳐요.",
        ],
    },

    # ───────────── 볶음(가위/중불/짧게) ─────────────
    "김치볶음밥": {
        "도구": ["프라이팬", "주걱", "가위", "그릇"],
        "재료": ["밥", "김치", "식용유"],
        "순서": [
            "① 김치를 가위로 잘게 잘라요.",
            "② 프라이팬에 식용유를 조금 넣어요.",
            "③ 불을 중불로 켜요.",
            "④ 김치를 넣어요.",
            "⑤ 2분 볶아요.",
            "⑥ 밥을 넣어요.",
            "⑦ 3분 볶아요.",
            "⑧ 그릇에 담아요.",
        ],
    },
    "소세지야채볶음": {
        "도구": ["프라이팬", "주걱", "그릇"],
        "재료": ["소세지", "케첩", "식용유"],
        "순서": [
            "① 프라이팬에 식용유를 조금 넣어요.",
            "② 불을 중불로 켜요.",
            "③ 소세지를 넣어요.",
            "④ 3분 볶아요.",
            "⑤ 케첩을 넣어요.",
            "⑥ 1분 더 볶아요.",
            "⑦ 그릇에 담아요.",
        ],
    },

    # ───────────── 간식/빵(약불/짧게) ─────────────
    "식빵토스트": {
        "도구": ["프라이팬", "뒤집개"],
        "재료": ["식빵", "버터"],
        "순서": [
            "① 프라이팬을 약불로 켜요.",
            "② 버터를 프라이팬에 살짝 녹여요.",
            "③ 식빵을 올려요.",
            "④ 2분 구워요.",
            "⑤ 뒤집어요.",
            "⑥ 1분 구워요.",
        ],
    },
    "햄치즈토스트": {
        "도구": ["프라이팬", "뒤집개"],
        "재료": ["식빵", "햄", "치즈", "버터"],
        "순서": [
            "① 식빵 위에 햄을 올려요.",
            "② 치즈를 올려요.",
            "③ 다른 식빵으로 덮어요.",
            "④ 프라이팬을 약불로 켜요.",
            "⑤ 버터를 살짝 녹여요.",
            "⑥ 토스트를 올려요.",
            "⑦ 3분 구워요.",
            "⑧ 뒤집어요.",
            "⑨ 3분 구워요.",
        ],
    },

    # ───────────── 샐러드/무침(칼 최소) ─────────────
    "야채샐러드": {
        "도구": ["그릇", "가위", "숟가락"],
        "재료": ["양상추", "샐러드소스"],
        "순서": [
            "① 양상추를 그릇에 넣어요.",
            "② 가위로 잘게 잘라요.",
            "③ 소스를 뿌려요.",
            "④ 숟가락으로 섞어요.",
        ],
    },

    # ───────────── 파스타(포장시간만) ─────────────
    "토마토파스타(간단)": {
        "도구": ["냄비", "프라이팬", "그릇"],
        "재료": ["스파게티면", "시판 토마토소스", "물"],
        "순서": [
            "① 냄비에 물을 넣어요.",
            "② 불을 중불로 켜요.",
            "③ 물이 끓으면 면을 넣어요.",
            "④ 포장지에 적힌 시간만큼 기다려요.",
            "⑤ 면을 물에서 꺼내요.",
            "⑥ 프라이팬을 중불로 켜요.",
            "⑦ 소스를 넣고 1분 데워요.",
            "⑧ 면을 넣고 1분 섞어요.",
            "⑨ 그릇에 담아요.",
        ],
    },
}


HEALTH_ROUTINES: Dict[str, Dict] = {
    "sit": {
        "id": "sit",
        "name": "앉아서 하는 운동",
        "steps": [
            "의자에 편하게 앉아요.",
            "등을 곧게 펴요.",
            "어깨를 올렸다가 내려요. 10번 해요.",
            "무릎을 하나씩 들어 올려요. 10번 해요.",
            "숨을 크게 들이마시고 천천히 내쉬어요.",
        ],
    },
    "stand": {
        "id": "stand",
        "name": "서서 하는 운동",
        "steps": [
            "두 발을 어깨 넓이로 벌리고 서요.",
            "양팔을 위로 올렸다가 내려요. 10번 해요.",
            "제자리에서 천천히 걸어요. 20번 해요.",
            "뒤꿈치를 들었다가 내려요. 15번 해요.",
            "가볍게 몸을 털고 마쳐요.",
        ],
    },
}


def get_all_recipe_names() -> List[str]:
    return list(BASE_RECIPES.keys())


def suggest_recipes_from_text(task: str) -> List[str]:
    """
    스케줄의 task에서 레시피 이름을 찾아 자동 후보로 사용.
    예: "라면 먹기" → ["라면"]
    """
    if not task:
        return []
    result = []
    for name in BASE_RECIPES.keys():
        if name in task:
            result.append(name)
    return result


def get_recipe(name: str) -> Dict:
    base = BASE_RECIPES.get(name)
    if not base:
        return {}
    return {
        "id": name,
        "name": name,
        "tools": base.get("도구", []),
        "ingredients": base.get("재료", []),
        "steps": base.get("순서", []),
    }


def get_health_modes() -> List[Dict]:
    return [
        {"id": "sit", "name": "앉아서 하는 운동"},
        {"id": "stand", "name": "서서 하는 운동"},
    ]


def get_health_routine(mode_id: str) -> Dict:
    return HEALTH_ROUTINES.get(mode_id, {})
